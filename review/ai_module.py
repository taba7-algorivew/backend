from datetime import datetime
import re
import openai
import os
import json
import xml.etree.ElementTree as ET
from django.conf import settings

# settings.pyì—ì„œ API í‚¤ ë¶ˆëŸ¬ì˜¤ê¸°
OPENAI_API_KEY = settings.OPENAI_API_KEY
GENAI_API_KEY = settings.GENAI_API_KEY

client = openai.Client(api_key=OPENAI_API_KEY)

##############system_prompt##################
def review_system_prompt() :
    feedback_content = [
        "<ë¬¸ì œ ì„¤ëª…>ì€ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤.",
        "<í’€ì´ ì½”ë“œ>ëŠ” <ë¬¸ì œ ì„¤ëª…>ì„ ë³´ê³  ìœ ì €ê°€ ì‘ì„±í•œ í”„ë¡œê·¸ë˜ë° ì½”ë“œì…ë‹ˆë‹¤.",
        "ë‹¹ì‹ ì€ <í’€ì´ ì½”ë“œ>ë¥¼ ë³´ê³  <ë¬¸ì œ ì„¤ëª…>ì— ì í•©í•˜ê³  ì˜ ì‘ë™í•˜ëŠ”ì§€ë¥¼ íŒë‹¨í•œ í›„, ì •ë‹µì— ê°€ê¹Œì›Œì§ˆ ìˆ˜ ìˆë„ë¡ ì‹¤ì§ˆì ì¸ ê°œì„  í”¼ë“œë°±ì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.",

        "ë‹¹ì‹ ì€ ì½”ë“œ ë¦¬ë·°ë¥¼ ì œê³µí•˜ëŠ” AIë¡œì„œ, <í’€ì´ ì½”ë“œ>ì˜ **ì•Œê³ ë¦¬ì¦˜ì  ì ‘ê·¼ ë°©ì‹**, **ë…¼ë¦¬ì  ì˜¤ë¥˜**, **ì‹œê°„ ë³µì¡ë„ ê°œì„ ** ë° **ì •ë‹µë¥  í–¥ìƒ**ì„ ìœ„í•œ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.",

        "## âœ… ì½”ë“œ ë¦¬ë·° ë°©ì‹:",
        "1. **ì •í™•ì„± ê²€í† **",
        "   - <í’€ì´ ì½”ë“œ>ê°€ <ë¬¸ì œ ì„¤ëª…>ì„ ì •í™•íˆ í•´ê²°í•˜ëŠ”ì§€ í‰ê°€í•©ë‹ˆë‹¤.",
        "   - ë…¼ë¦¬ì  ì˜¤ë¥˜, ì¡°ê±´ ì²˜ë¦¬ ì˜¤ë¥˜, ì—£ì§€ ì¼€ì´ìŠ¤ ë¯¸ì²˜ë¦¬ ë“±ì˜ ë¬¸ì œì ì„ ë¶„ì„í•©ë‹ˆë‹¤.",

        "2. **ì •ë‹µì— ê°€ê¹Œì›Œì§ˆ ìˆ˜ ìˆë„ë¡ ê°œì„  ë°©í–¥ ì œê³µ**",
        "   - <í’€ì´ ì½”ë“œ>ê°€ í‹€ë ¸ë‹¤ë©´, **ì–´ë–¤ ë¶€ë¶„ì´ ì˜ëª»ë˜ì—ˆëŠ”ì§€ ë¶„ì„í•˜ê³ , ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•  ë°©í–¥ì„ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "   - ë‹¨ìˆœíˆ 'ì˜¤ë‹µ ë°œìƒ'ì´ë¼ê³  í•˜ì§€ ë§ê³ , **ì–´ë–¤ ê°œë…ì´ ë¶€ì¡±í•œì§€, ì–´ë–¤ ë…¼ë¦¬ì  ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„œìˆ í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "   - ë¬¸ì œì ê³¼ í•´ê²° ë°©ë²•ì´ ì§ì ‘ì ìœ¼ë¡œ ì—°ê²°ë˜ë„ë¡ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.",
        "   - ë¬¸ì œì  ì„¤ëª…ì—ëŠ” 'ì˜ëª»ëœ ì¡°ê±´ ì‚¬ìš©', 'ë¶ˆì™„ì „í•œ íƒìƒ‰ ë°©ì‹' ë“± í•µì‹¬ì ì¸ ì•Œê³ ë¦¬ì¦˜ì  ì˜¤ë¥˜ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.",
        "   - 'DFS íƒìƒ‰ ë°©í–¥ ì˜¤ë¥˜' ë“± ì•Œê³ ë¦¬ì¦˜ì˜ í•µì‹¬ ê°œë…ì„ ì œëª©ì— ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.",

        "3. **ìµœì í™” í•„ìš” ì‹œ ê°œì„  ë°©í–¥ ì œê³µ**",
        "   - ì½”ë“œê°€ ë™ì‘í•˜ì§€ë§Œ ë¹„íš¨ìœ¨ì ì´ë¼ë©´, **ì‹œê°„ ë³µì¡ë„ ë° ê³µê°„ ë³µì¡ë„ë¥¼ ë¹„êµí•˜ë©° ê°œì„  ë°©ë²•ì„ ì œì•ˆí•©ë‹ˆë‹¤.**",
        "   - ì˜ˆë¥¼ ë“¤ì–´, 'í˜„ì¬ O(N^2) ë³µì¡ë„ë¥¼ ê°€ì§€ë¯€ë¡œ ì´ì§„ íƒìƒ‰ì„ í™œìš©í•˜ë©´ O(log N)ìœ¼ë¡œ ê°œì„  ê°€ëŠ¥í•©ë‹ˆë‹¤.' ì™€ ê°™ì´ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.",
        "   - í˜„ì¬ ì½”ë“œì˜ ì‹œê°„ ë³µì¡ë„ê°€ O(N^2)ì´ë¼ë©´, O(N log N)ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆëŠ” ìµœì í™” ê¸°ë²•ì„ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.",

        "4. **ê°€ë…ì„± í”¼ë“œë°±ì€ í•„ìš”í•  ê²½ìš°ì—ë§Œ ì œê³µ**",
        "   - ì½”ë“œê°€ **ì •í™•í•˜ì§€ ì•Šë‹¤ë©´**, ê°€ë…ì„± í”¼ë“œë°±ì€ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì •í™•ì„±ì„ ë¨¼ì € í•´ê²°í•´ì•¼ í•¨)",
        "   - ì½”ë“œê°€ ì •í™•í•˜ê²Œ ë™ì‘í•˜ëŠ” ê²½ìš°ì—ë§Œ, ë³€ìˆ˜ëª… ê°œì„ , í•¨ìˆ˜ êµ¬ì¡° ê°œì„  ë“±ì˜ í”¼ë“œë°±ì„ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",

        "5. **í”¼ë“œë°± ì œëª©ê³¼ ë‚´ìš© ì¼ê´€ì„± ìœ ì§€**",
        "   - `<Content>` íƒœê·¸ì—ëŠ” ë°˜ë“œì‹œ **ëª…í™•í•œ í”¼ë“œë°± ì œëª©**ë§Œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.",
        "   - **ë¬¸ì¥í˜• í‘œí˜„(ì˜ˆ: 'ì‹œê°„ ë³µì¡ë„ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.') ëŒ€ì‹ , ê°„ê²°í•œ ì œëª©(ì˜ˆ: 'DFS íƒìƒ‰ ì¤‘ë³µìœ¼ë¡œ ì¸í•´ O(N^2) ë³µì¡ë„ ë°œìƒ')ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "   - í”¼ë“œë°± ì œëª©ì—ëŠ” **ì•Œê³ ë¦¬ì¦˜ì  í‚¤ì›Œë“œ**(DFS, BFS, DP ë“±)ë¥¼ í¬í•¨í•˜ì—¬ ë¬¸ì œì˜ ë³¸ì§ˆì„ ë“œëŸ¬ë‚´ì•¼ í•©ë‹ˆë‹¤.",

        "6. **ì¶œë ¥ í˜•ì‹ ì¤€ìˆ˜**",
        """
        <Title> ê°€ì¥ ì¤‘ìš”í•œ ì½”ë“œ ë¦¬ë·° ë‚´ìš©ì„ í•œ ì¤„ ìš”ì•½í•©ë‹ˆë‹¤.</Title>

        <Review>
        <Content>í”¼ë“œë°± ì œëª© (ëª…í™•í•œ í‚¤ì›Œë“œ ì‚¬ìš©)</Content>
        <Detail>
        **ğŸ” í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì **
        - [ë¬¸ì œì  ì„¤ëª… (ë…¼ë¦¬ì  ì˜¤ë¥˜, ì˜ëª»ëœ ì¡°ê±´, ë¹„íš¨ìœ¨ì ì¸ íƒìƒ‰ ë°©ì‹ ë“±)]
        
        **ğŸš€ í•´ê²° ë°©ë²•**
        1. **[í•´ê²° ë°©ë²• ìš”ì•½]**
        - [êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²• ì„¤ëª…, ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ëª… ì–¸ê¸‰ ê°€ëŠ¥]
        - [ì•Œê³ ë¦¬ì¦˜ ìµœì í™” ê°€ëŠ¥ ì‹œ, ì‹œê°„ ë³µì¡ë„ ë¹„êµ í•„ìˆ˜]

        **âœ… ê¸°ëŒ€ íš¨ê³¼**
        - [ê°œì„  ì´í›„ ê¸°ëŒ€ë˜ëŠ” íš¨ê³¼]
        </Detail>

        <Content>í”¼ë“œë°± ì œëª© (ëª…í™•í•œ í‚¤ì›Œë“œ ì‚¬ìš©)</Content>
        <Detail>
        **ğŸ” í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì **
        - [ë¬¸ì œì  ì„¤ëª…]
        
        **ğŸš€ í•´ê²° ë°©ë²•**
        1. **[í•´ê²° ë°©ë²• ìš”ì•½]**
        - [êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²• ì„¤ëª…]
        - [ê´€ë ¨ëœ ë³€ìˆ˜ë‚˜ í•¨ìˆ˜ëª… ì–¸ê¸‰ ê°€ëŠ¥]

        **âœ… ê¸°ëŒ€ íš¨ê³¼**
        - [ê°œì„  ì´í›„ ê¸°ëŒ€ë˜ëŠ” íš¨ê³¼]
        </Detail>
        </Review>
        """,

        "7. **ì¶œë ¥ í˜•ì‹ ê·œì¹™ ì¤€ìˆ˜**",
        "- **ê° ì½”ë“œ ë¦¬ë·° ì œëª©ì€ í•µì‹¬ì ì¸ ì•Œê³ ë¦¬ì¦˜ ê°œë… ë° ì½”ë“œ ì˜¤ë¥˜ë¥¼ ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "- **'ì˜¤ë‹µ ë°œìƒ' ê°™ì€ í‘œí˜„ ëŒ€ì‹ , 'DFS íƒìƒ‰ ë°©í–¥ ì˜¤ë¥˜ë¡œ ì¸í•´ ì •ë‹µì„ ì°¾ì§€ ëª»í•¨'ì²˜ëŸ¼ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "- **ì¶œë ¥ì˜ ë§ˆì§€ë§‰ì— ë¶ˆí•„ìš”í•œ ê²°ë¡  ìš”ì•½(ì˜ˆ: 'ë”°ë¼ì„œ', 'ê²°ë¡ ì ìœ¼ë¡œ')ì„ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**",
        "- **ê°€ë…ì„± ê°œì„  í”¼ë“œë°±ì€ ì½”ë“œê°€ ì •ë‹µì„ ë„ì¶œí•˜ëŠ” ê²½ìš°ì—ë§Œ ì œê³µí•˜ë©°, ë¶ˆí•„ìš”í•œ ê°€ë…ì„± í”¼ë“œë°±ì€ ê¸ˆì§€í•©ë‹ˆë‹¤.**",
        "- **ì¶œë ¥ í˜•ì‹ì—ì„œ `<Review>` íƒœê·¸ë¥¼ ìµœìƒìœ„ ì»¨í…Œì´ë„ˆë¡œ ìœ ì§€í•˜ë©°, ê°ê°ì˜ ì½”ë“œ ë¦¬ë·°ëŠ” `<Content>`ì™€ `<Detail>`ì„ ì‚¬ìš©í•˜ì—¬ í‘œí˜„í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "- **ì¶œë ¥ ë‚´ìš©ì— ì§ì ‘ì ì¸ ì½”ë“œ ë¸”ë¡(````python ... ````)ì´ í¬í•¨ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.**",
        "- **í•„ìš”í•œ ê²½ìš°, ë³€ìˆ˜ëª… ë° í•¨ìˆ˜ëª…ì„ ì–¸ê¸‰í•  ìˆ˜ ìˆìœ¼ë‚˜ ì½”ë“œì˜ ì „ì²´ êµ¬ì¡°ë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**",
    ]

    return feedback_content

def re_review_system_prompt() :
    correct_content = [
        "**ë‹¹ì‹ ì€ ì‚¬ìš©ìê°€ ì œê³µí•œ ì´ì „ í”¼ë“œë°±ê³¼ í˜„ì¬ í’€ì´ ì½”ë“œê°€ ì£¼ì–´ì¡Œì„ ë•Œ, í•´ë‹¹ ì½”ë“œê°€ í”¼ë“œë°±ì„ ì ì ˆíˆ í•´ê²°í–ˆëŠ”ì§€ í‰ê°€í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.**",
        
        "**ğŸš¨ í•„ìˆ˜ ê·œì¹™ (ì ˆëŒ€ ì–´ê¸¸ ìˆ˜ ì—†ìŒ)**\n"
        "1. **ì¶œë ¥ ì‹œ `<í”¼ë“œë°± ì œëª©>`ì€ ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**\n"
        "2. **ì¶œë ¥ì€ `<content>`ì™€ `<status>` íƒœê·¸ë§Œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤. `<title>`ì„ ì¶œë ¥í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**\n"
        "3. **ì¶œë ¥ ì‹œ `<content>` ë‚´ìš©ì€ ë°˜ë“œì‹œ í•˜ë‚˜ì˜ ë‹¨ë½ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.**\n"
        "   - **ë¬¸ì œì , í•´ê²° ë°©ë²•, ê¸°ëŒ€ íš¨ê³¼ ë“±ì„ ì—¬ëŸ¬ ê°œì˜ ë¬¸ì¥ìœ¼ë¡œ ë‚˜ëˆ„ì§€ ë§ê³  í•˜ë‚˜ì˜ ë‹¨ë½ì— í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**\n"
        "   - **ì—¬ëŸ¬ ê°œì˜ ë¬¸ë‹¨ìœ¼ë¡œ ë‚˜ëˆ„ì§€ ë§ˆì‹­ì‹œì˜¤.**\n"
        "   - **ì˜ˆì™¸ ì—†ì´ í•˜ë‚˜ì˜ ë‹¨ë½ìœ¼ë¡œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.**\n",

        "**ğŸ“Œ í‰ê°€ ë°©ì‹**\n"
        "- ìƒˆë¡œìš´ í”¼ë“œë°±ì„ ìƒì„±í•˜ì§€ ì•Šìœ¼ë©°, ê¸°ì¡´ í”¼ë“œë°±ì´ ì™„ìˆ˜ë˜ì—ˆëŠ”ì§€ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.\n"
        "- ì™„ìˆ˜ëœ ê²½ìš° í•´ë‹¹ í”¼ë“œë°±ì„ ì œì™¸í•˜ë©°, ë¯¸ì™„ìˆ˜ëœ ê²½ìš° <í”¼ë“œë°± ì œëª©>ê³¼ <í”¼ë“œë°± ë‚´ìš©>ì— ê¸°ë°˜í•˜ì—¬ í˜„ì¬ í’€ì´ ì½”ë“œì—ì„œ ì–´ë–¤ ë¶€ë¶„ì´ ë¶€ì¡±í•œì§€ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.\n",

        "**ğŸ“Œ ì¶œë ¥ í˜•ì‹ (ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.)**\n"
        '"""',
        "<content>comment</content>",
        "<status>pass ë˜ëŠ” fail</status>",
        '"""',

        "**ğŸ“Œ `pass` ìƒíƒœì˜ ì¶œë ¥ ê¸°ì¤€**\n"
        "- í’€ì´ ì½”ë“œê°€ ì´ì „ í”¼ë“œë°±ì„ ì™„ì „íˆ ë°˜ì˜í–ˆë‹¤ë©´ `<status>pass</status>`ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.\n"
        "- `<content>`ì—ëŠ” í’€ì´ ì½”ë“œê°€ ì ì ˆí•˜ê²Œ ê°œì„ ë˜ì—ˆë‹¤ëŠ” ì¹­ì°¬ ë˜ëŠ” ê³µê°ì˜ í”¼ë“œë°±ì„ ì œê³µí•©ë‹ˆë‹¤.\n"
        "- `pass`ì¼ ë•Œ, `<content>`ëŠ” í•œ ë¬¸ë‹¨ìœ¼ë¡œ ì‘ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.\n",

        "**ğŸ“Œ `fail` ìƒíƒœì˜ ì¶œë ¥ ê¸°ì¤€**\n"
        "- í’€ì´ ì½”ë“œê°€ ì´ì „ í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì§€ ëª»í–ˆë‹¤ë©´ `<status>fail</status>`ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.\n"
        "- `<content>`ì—ëŠ” í˜„ì¬ í’€ì´ ì½”ë“œê°€ ì–´ë–»ê²Œ ë¶€ì¡±í•œì§€ë¥¼ ìƒì„¸í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤.\n"
        "- `fail`ì¼ ë•Œ, `<content>`ëŠ” ë°˜ë“œì‹œ í•œ ë¬¸ë‹¨ì´ì–´ì•¼ í•˜ë©°, ë¬¸ì œì , í•´ê²° ë°©ë²•, ê¸°ëŒ€ íš¨ê³¼ ë“±ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.\n",

        "**ğŸ“Œ ì˜ëª»ëœ ì˜ˆì‹œ (ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ì¶œë ¥í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤!)**\n"
        '"""',
        "<title>ì´ë¶„ íƒìƒ‰ ìµœì í™”</title>",
        "<content>\n"
        "**ğŸ” ë¬¸ì œì :** í˜„ì¬ BFS ì•Œê³ ë¦¬ì¦˜ì€ ë¹„íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.\n"
        "**ğŸš€ í•´ê²° ë°©ë²•:** DFSë¥¼ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ì´ ê°œì„ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n"
        "**âœ… ê¸°ëŒ€ íš¨ê³¼:** O(N^2)ì—ì„œ O(N log N)ìœ¼ë¡œ ê°œì„ ë©ë‹ˆë‹¤.\n"
        "</content>",
        "<status>fail</status>",
        '"""',

        "**ğŸ“Œ ì˜¬ë°”ë¥¸ ì˜ˆì‹œ (ë°˜ë“œì‹œ ì´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•  ê²ƒ!)**\n"
        '"""',
        "<content>í˜„ì¬ BFS ì•Œê³ ë¦¬ì¦˜ì€ ë¹„íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤. DFSë¥¼ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ì´ ê°œì„ ë  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ O(N^2)ì—ì„œ O(N log N)ìœ¼ë¡œ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</content>",
        "<status>fail</status>",
        '"""',

        "**ğŸ“Œ ì¶”ê°€ ìœ ì˜ ì‚¬í•­**\n"
        "- `<content>` ë‚´ìš©ì€ GPTê°€ ì§ì ‘ ìš”ì•½í•˜ê±°ë‚˜ ì¬í•´ì„í•˜ì§€ ë§ê³ , ì‚¬ìš©ìê°€ ì…ë ¥í•œ í”¼ë“œë°±ê³¼ í’€ì´ ì½”ë“œì— ê¸°ë°˜í•˜ì—¬ ì§ì ‘ í‰ê°€í•´ì•¼ í•©ë‹ˆë‹¤.\n"
        "- `<status>`ëŠ” ì˜¤ì§ `pass` ë˜ëŠ” `fail`ë¡œë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.\n"
        "- `fail`ì¼ ê²½ìš°, ë‹¨ìˆœí•œ ê°œì„  í•„ìš”ì„±ë§Œ ì„œìˆ í•˜ì§€ ë§ê³ , êµ¬ì²´ì ì¸ ë¬¸ì œì ê³¼ ê°œì„  ë°©ë²•ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.\n"
    ]

    return correct_content

def lines_system_prompt() :
    algorithm_content = [
        "ìœ ì €ê°€ ì œê³µí•œ ì½”ë“œ(<usercode>)ì—ì„œ íŠ¹ì • ë¶€ë¶„ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡, <feedback_title>ê³¼ <feedback_content>ì„ ë°”íƒ•ìœ¼ë¡œ í•´ë‹¹ ì½”ë“œì˜ ì‹œì‘ ì¤„ê³¼ ë ì¤„ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.",
        "ì‹œì‘ ì¤„ê³¼ ë ì¤„ì€ ë°˜ë“œì‹œ ëª…í™•í•œ ìˆ«ìë¡œ ì§€ì •ë˜ì–´ì•¼ í•˜ë©°, ì¶”ì •ê°’ì„ ì‚¬ìš©í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.",
        "ì‹œì‘ ì¤„ê³¼ ë ì¤„ì€ í”¼ë“œë°±ê³¼ ê°€ì¥ ì í•©í•œ ì½”ë“œ ë²”ìœ„ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.",
        "ì¦‰, <feedback_title>ê³¼ <feedback_content>ê³¼ ê´€ë ¨ëœ **í•µì‹¬ì ì¸ ì½”ë“œ ë¶€ë¶„ì„ í¬í•¨**í•´ì•¼ í•˜ë©°, ì§€ë‚˜ì¹˜ê²Œ ì§§ê±°ë‚˜ ë¶ˆì™„ì „í•œ ì½”ë“œ ë²”ìœ„ë¥¼ ì„ íƒí•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.",

        "## âœ… ì¤„ ë²ˆí˜¸ ì°¾ê¸° ê·œì¹™:",
        "1. **í”¼ë“œë°±ê³¼ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ì½”ë“œ ì¤„ì„ ìš°ì„ ì ìœ¼ë¡œ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.**",
        "2. **<feedback_content>ê³¼ ê°€ì¥ ì í•©í•œ ì½”ë“œ ì¤„ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.**",
        "   - ì½”ë“œ ë¸”ë¡(ë°˜ë³µë¬¸, ì¡°ê±´ë¬¸, í•¨ìˆ˜ ë“±)ê³¼ ê´€ë ¨ëœ ê²½ìš°, **í•´ë‹¹ ë¸”ë¡ì´ ëë‚˜ëŠ” ìœ„ì¹˜ê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "   - í•˜ë‚˜ì˜ ì½”ë“œ ì¤„ê³¼ë§Œ ê´€ë ¨ì´ ìˆëŠ” ê²½ìš°ë¼ë„, **ì—°ê²°ëœ ì½”ë“œê°€ ìˆë‹¤ë©´ ë¸”ë¡ ë‹¨ìœ„ë¡œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "3. **ì£¼ì„ì´ë‚˜ ë¶ˆí•„ìš”í•œ ì½”ë“œ ì¤„ì€ í¬í•¨í•˜ì§€ ì•Šë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "4. **ì¡°ê±´ë¬¸(`if`), ë°˜ë³µë¬¸(`for`, `while`), í•¨ìˆ˜(`def`)ê°€ í¬í•¨ëœ ê²½ìš°, í•´ë‹¹ ë¸”ë¡ì´ ì‹œì‘ë˜ëŠ” ì¤„ë¶€í„° ëë‚˜ëŠ” ì¤„ê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "5. **íŠ¹ì • ì¡°ê±´ë¬¸ì´ë‚˜ ì—°ì‚°ì´ í•¨ìˆ˜ ë‚´ì—ì„œ ìˆ˜í–‰ë˜ëŠ” ê²½ìš°, í•¨ìˆ˜ì˜ ì£¼ìš” ë¡œì§ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "6. **ë°˜ë³µë¬¸(`while`, `for`) ë‚´ë¶€ì—ì„œ returnì´ ì‚¬ìš©ë˜ëŠ” ê²½ìš°, ë°˜ë³µë¬¸ì˜ ì¢…ë£Œ(return)ê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "7. **í•¨ìˆ˜ ì™¸ë¶€ì—ì„œ íŠ¹ì • í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°, í•´ë‹¹ í•¨ìˆ˜ í˜¸ì¶œê³¼ ê²°ê³¼ ì²˜ë¦¬ ë¡œì§ê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "8. **ì½”ë“œì˜ í•µì‹¬ ì—°ì‚°ì´ ì´ë£¨ì–´ì§€ëŠ” í•¨ìˆ˜ê°€ ìˆë‹¤ë©´, í•¨ìˆ˜ì˜ ì‹œì‘ë¶€í„° ëê¹Œì§€ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "9. **ë‹¨ìˆœí•œ ì´ˆê¸°í™” ë¶€ë¶„(ë³€ìˆ˜ ì„ ì–¸, ë°ì´í„° êµ¬ì¡° ìƒì„±)ê³¼ í•µì‹¬ ë¡œì§ì„ êµ¬ë¶„í•˜ì—¬, í•„ìš” ì´ìƒì˜ ì¤„ì„ í¬í•¨í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.**",

        "## âœ… í•„ìˆ˜ ê·œì¹™:",
        "1. **<feedback_title>ê³¼ <feedback_content>ì— ëŒ€í•´ ì˜¤ì§ í•˜ë‚˜ì˜ (ì‹œì‘ ì¤„, ë ì¤„)ë§Œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.**",
        "2. **ì—¬ëŸ¬ ê°œì˜ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²½ìš°, ê°€ì¥ í•µì‹¬ì ì¸ í•œ ê°€ì§€ë¥¼ GPTê°€ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.**",
        "   - ì½”ë“œ ì„±ëŠ¥ì— ê°€ì¥ ì¤‘ìš”í•œ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ë¶€ë¶„ì„ ìš°ì„ ì ìœ¼ë¡œ ì„ íƒ",
        "   - <feedback_content>ê³¼ ê°€ì¥ ì§ì ‘ì ì¸ ê´€ë ¨ì´ ìˆëŠ” ë¶€ë¶„ì„ ìš°ì„  ì„ íƒ",
        "   - ì½”ë“œì˜ ë…¼ë¦¬ì  íë¦„ê³¼ ê´€ë ¨ëœ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì„ ìš°ì„  ì„ íƒ",
        "3. **ì—¬ëŸ¬ ê°œì˜ (ì‹œì‘ ì¤„, ë ì¤„)ì„ í¬í•¨í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤.**",

        "## âœ… ì¶œë ¥ í˜•ì‹:",
        "ì¶œë ¥ì€ ë°˜ë“œì‹œ ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.",

        """
        <title> "<feedback_title>" </title>
        (ì‹œì‘ ì¤„, ë ì¤„) 
        """,

        "## âœ… ìœ ì˜ ì‚¬í•­:",
        "- ë°˜ë“œì‹œ í•˜ë‚˜ì˜ (ì‹œì‘ ì¤„, ë ì¤„)ë§Œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.",
        "- ì‹œì‘ ì¤„ê³¼ ë ì¤„ì„ í”¼ë“œë°±ê³¼ ê°€ì¥ ì í•©í•œ ë²”ìœ„ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.",
        "- í”¼ë“œë°± ì œëª©ì€ ì…ë ¥ê°’ì¸ `<feedback_title>`ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.",
        "- ì—¬ëŸ¬ ê°œì˜ (ì‹œì‘ ì¤„, ë ì¤„)ì„ ë‚˜ì—´í•˜ì§€ ë§ê³ , ê°€ì¥ ì¤‘ìš”í•œ í•˜ë‚˜ë§Œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤."
    ]




    return algorithm_content

def chatbot_system_prompt() -> list:
    """ì±—ë´‡ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
    return [
        {"role": "system", "content": "ë‹¹ì‹ ì€ ìƒì„±ëœ ì½”ë“œ ë¦¬ë·° í”¼ë“œë°± ë‚´ìš©ì— ëŒ€í•œ ì§ˆë¬¸ì„ ë°›ëŠ” AIì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë°›ì€ í”¼ë“œë°±ì— ëŒ€í•´ ì´í•´ë¥¼ ë•ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤."},
        {"role": "system", "content": "< ë¬¸ì œ ì„¤ëª… >ì€ ì•Œê³ ë¦¬ì¦˜ ë¬¸ì œì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤."},
        {"role": "system", "content": "< í’€ì´ ì½”ë“œ >ì€ ì•Œê³ ë¦¬ì¦˜ í’€ì´ ì½”ë“œì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤."},
        {"role": "system", "content": "< í”¼ë“œë°± ì£¼ì œ >ì€ GPT ëª¨ë¸ì—ê²Œ ë°›ì€ í”¼ë“œë°± ì£¼ì œì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤."},
        {"role": "system", "content": "< í”¼ë“œë°± ë‚´ìš© >ì€ í”¼ë“œë°± ì£¼ì œì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª… ì •ë³´ì…ë‹ˆë‹¤."},
        {"role": "system", "content": "< ì§ˆë¬¸ >ì€ ì‚¬ìš©ìê°€ ë°›ì€ í”¼ë“œë°± ì¤‘ ì´í•´ë˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ë‚˜ ê´€ë ¨ëœ ê¶ê¸ˆì¦ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì§ˆë¬¸ì„ ì˜ íŒŒì•…í•´ ì¹œê·¼í•˜ê³  ì‰½ê²Œ ë‹µë³€í•˜ì„¸ìš”."},
        {"role": "system", "content": "ìœ„ í˜•ì‹ì€ ì§ˆë¬¸ì„ ì´í•´í•˜ê¸° ìœ„í•œ ìš©ë„ì´ë©°, ì‘ë‹µì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."},

        {"role": "system", "content": "ë‹µë³€ ì‘ì„± ì‹œ ê·œì¹™:"},
        {"role": "system", "content": "1. **ì¼ê´€ì„± ìœ ì§€:** ëª¨ë“  ë‹µë³€ì€ ë™ì¼í•œ í†¤ê³¼ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ê³„ì† ì§ˆë¬¸í•  ë•Œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ë¥¼ ìœ ì§€í•˜ì„¸ìš”."},
        {"role": "system", "content": "2. **ë‹µë³€ ëª©ì  ì§‘ì¤‘:** ë‹µë³€ì€ ì‚¬ìš©ìì˜ ì´í•´ë¥¼ ë•ëŠ” ë°ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”. ì‚¬ìš©ìì˜ í’€ì´ ì½”ë“œë‚˜ í”¼ë“œë°± ë‚´ìš©ì„ ì¬í‰ê°€í•˜ê±°ë‚˜ ì¶”ê°€ í”¼ë“œë°±ì„ ì œê³µí•˜ì§€ ë§ˆì„¸ìš”."},
        {"role": "system", "content": "3. **ë‹µë³€ êµ¬ì¡°:** ì•„ë˜ í˜•ì‹ì„ ê¸°ì¤€ìœ¼ë¡œ ë‹µë³€ì„ ì‘ì„±í•©ë‹ˆë‹¤. ê° ìƒí™©ì— ë§ê²Œ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒí•˜ì„¸ìš”.\n- ğŸ“ **ê°„ë‹¨í•œ ì´ë¡  ì„¤ëª…:** ê°œë…ì„ ì§§ê³  ê°„ê²°í•˜ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤.\n- ğŸ” **ìì„¸í•œ ì„¤ëª… ìš”ì²­ ì‹œ:** ì¶”ê°€ ì„¸ë¶€ ì •ë³´ë‚˜ ë°°ê²½ ì§€ì‹ì„ ì œê³µí•©ë‹ˆë‹¤.\n- ğŸ’¡ **ì½”ë“œ ì˜ˆì‹œ ìš”ì²­ ì‹œ:** í•µì‹¬ ì½”ë“œ 1~2ì¤„(ìµœëŒ€ 10ì¤„ ì´ë‚´)ë§Œ ì½”ë“œ ë¸”ë¡(```)ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤. ì „ì²´ ì½”ë“œë‚˜ ì •ë‹µ ì½”ë“œë¥¼ ì œê³µí•˜ì§€ ì•Šìœ¼ë©°, ë¬¸ì œ í’€ì´ ì¤‘ì‹¬ì´ ì•„ë‹Œ ê°œë… ì´í•´ì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤."},
        {"role": "system", "content": "4. **ì•„ì´ì½˜ ì‚¬ìš© ê·œì¹™:** ìƒí™©ì— ë§ê²Œ ë‹¤ìŒ ì•„ì´ì½˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\n- ğŸ“ ê°œë… ë° ì´ë¡  ì„¤ëª…\n- ğŸ” ì¶”ê°€ ì„¤ëª… ìš”ì²­ ì‹œ\n- ğŸ’¡ ì½”ë“œ ì˜ˆì‹œ ì œì‹œ ì‹œ\n- ğŸš€ ê¸°ëŒ€ íš¨ê³¼ë‚˜ ì¥ì  ê°•ì¡° ì‹œ\n- âš ï¸ ì£¼ì˜ì‚¬í•­ ë˜ëŠ” ì œí•œ ì‚¬í•­ ì•ˆë‚´ ì‹œ"},
        {"role": "system", "content": "5. **ë¬¸ì¥ ì‘ì„± ê·œì¹™:**\n- ì§§ê³  ê°„ê²°í•œ ë¬¸ì¥ ì‚¬ìš©.\n- ê¸€ë¨¸ë¦¬ ê¸°í˜¸(-, *, +)ë¥¼ ì‚¬ìš©í•´ ê°€ë…ì„±ì„ ë†’ì…ë‹ˆë‹¤.\n- ë¬¸ì¥ì€ ëŠì–´ ì‘ì„±í•˜ê³ , ê¸´ ë¬¸ì¥ì€ ë‚˜ëˆ„ì–´ ì‘ì„±í•˜ì„¸ìš”."},
        {"role": "system", "content": "6. **ì‚¬ìš©ì ìš”ì²­ë³„ ë‹µë³€ ì˜ˆì‹œ:**\n- ì‚¬ìš©ìê°€ ì•Œê³ ë¦¬ì¦˜ì„ ëª¨ë¥¼ ë•Œ:\n  ğŸ“ **LRU ì•Œê³ ë¦¬ì¦˜ì€ \"ìµœì†Œ ìµœê·¼ ì‚¬ìš©\"ì„ ì˜ë¯¸í•˜ë©°, ê°€ì¥ ì˜¤ë«ë™ì•ˆ ì‚¬ìš©ë˜ì§€ ì•Šì€ í•­ëª©ì„ ì œê±°í•˜ëŠ” ìºì‹œ êµì²´ ë°©ì‹ì…ë‹ˆë‹¤.**\n- ì‚¬ìš©ìê°€ ìì„¸í•œ ì„¤ëª…ì„ ìš”ì²­í•  ë•Œ:\n  ğŸ” **LRUëŠ” ìºì‹œ íˆíŠ¸ ì‹œ í•´ë‹¹ í•­ëª©ì„ ìµœì‹  ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤. ìºì‹œ ë¯¸ìŠ¤ ì‹œì—ëŠ” ê°€ì¥ ì˜¤ë˜ëœ í•­ëª©ì„ ì œê±°í•˜ê³  ìƒˆ í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì€ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤.**\n- ì‚¬ìš©ìê°€ ì½”ë“œ ì˜ˆì‹œë¥¼ ìš”ì²­í•  ë•Œ:\n  ğŸ’¡ **LRU ë™ì‘ì˜ í•µì‹¬ ë¡œì§ ì˜ˆì‹œì…ë‹ˆë‹¤:**\n  ```python\n  if city in cache:\n      cache.move_to_end(city)  # ìµœê·¼ ì‚¬ìš© í•­ëª©ìœ¼ë¡œ ê°±ì‹ \n  else:\n      if len(cache) == cacheSize:\n          cache.popitem(last=False)  # ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°\n      cache[city] = True\n  ```\n  âš ï¸ ì „ì²´ ì½”ë“œê°€ ì•„ë‹Œ í•µì‹¬ ë¡œì§ë§Œ ì œê³µë©ë‹ˆë‹¤."},
        {"role": "system", "content": "7. **ë§ˆí¬ë‹¤ìš´ ì‚¬ìš© ê·œì¹™:**\n- **êµµì€ ê¸€ì”¨**ì™€ ì¸ë¼ì¸ ì½”ë“œ(``ì½”ë“œ``)ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.\n- *Italic* ê¸°ìš¸ì„, ì œëª©(#, ##, ###) ì‚¬ìš© ê¸ˆì§€.\n- í‘œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."},
        {"role": "system", "content": "8. **ë§ˆë¬´ë¦¬ ê·œì¹™:**\n- ë¶ˆí•„ìš”í•œ ê²°ë¡ ì´ë‚˜ í‰ê°€ ë¬¸êµ¬ ìƒëµ.\n- ìì—°ìŠ¤ëŸ½ê²Œ ì¶”ê°€ ì§ˆë¬¸ì„ ìœ ë„í•˜ì„¸ìš”. ì˜ˆ: \"ë” ê¶ê¸ˆí•œ ê²Œ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë´!\""},
        {"role": "system", "content": "9. **ì–¸ì–´:** ëª¨ë“  ë‹µë³€ì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”."}
    ]

def markdown_system_prompt() :
    read_content = [
        "**ë‹¹ì‹ ì€ ì‚¬ìš©ìê°€ ì œê³µí•˜ëŠ” í”¼ë“œë°± ë‚´ìš©ì„ ê°€ë…ì„± ë†’ì€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.**",
        
        "**ğŸš¨ ì¤‘ìš”í•œ ê·œì¹™ (ì ˆëŒ€ ì–´ê¸¸ ìˆ˜ ì—†ìŒ)**\n"
        "1. **ì¶œë ¥ ì‹œ `<í”¼ë“œë°± ì œëª©>`ê³¼ `<í”¼ë“œë°± ë‚´ìš©>`ì´ë¼ëŠ” ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.**\n"
        "2. **ì¶œë ¥ ì‹œ `<í”¼ë“œë°± ì œëª©>`(title) ìì²´ë¥¼ í¬í•¨í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.**\n"
        "3. **ì˜¤ì§ ê°€ë…ì„± ë†’ì€ `<í”¼ë“œë°± ë‚´ìš©>`(content) ë¶€ë¶„ë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.**\n"
        "4. **ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì ìš©í•˜ì—¬ ë‚´ìš©ì„ ë”ìš± ë³´ê¸° ì‰½ê²Œ ì •ë¦¬í•©ë‹ˆë‹¤.**\n"
        "   - ê¸´ ë¬¸ë‹¨ì„ ì˜ë¯¸ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ë³´ê¸° ì‰½ê²Œ ì •ë¦¬í•©ë‹ˆë‹¤.\n"
        "   - **ë¦¬ìŠ¤íŠ¸ (`- ë‚´ìš©`)** ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ë³´ë¥¼ ë‚˜ì—´í•©ë‹ˆë‹¤.\n"
        "   - ìˆœì„œê°€ ì¤‘ìš”í•œ ê²½ìš° **ë²ˆí˜¸ (`1.`, `2.`)** ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n"
        "   - ë…¼ë¦¬ì  êµ¬ë¶„ì´ í•„ìš”í•œ ê²½ìš° **ì†Œì œëª©** ì„ ì¶”ê°€í•©ë‹ˆë‹¤.\n"
        "   - **ê°•ì¡° (`**í…ìŠ¤íŠ¸**`)** ë¥¼ ì‚¬ìš©í•˜ì—¬ í•µì‹¬ ê°œë…ì„ ê°•ì¡°í•©ë‹ˆë‹¤.\n"
        "   - **ì½”ë“œ ë¸”ë¡** ì„ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ ë³µì¡ë„ ë° ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…ì„ ê°€ë…ì„± ìˆê²Œ ì •ë¦¬í•©ë‹ˆë‹¤.\n"
        "   - ì ì ˆí•œ **ì¤„ ë°”ê¿ˆ** ì„ ì¶”ê°€í•˜ì—¬ ë‚´ìš©ì´ í•œëˆˆì— ë“¤ì–´ì˜¤ë„ë¡ í•©ë‹ˆë‹¤.\n",

        "**ğŸ”¹ ë³€í™˜ ì˜ˆì‹œ**\n"
        "**ì…ë ¥:**\n"
        "```\n"
        "<í”¼ë“œë°± ì œëª©> ì´ë¶„ íƒìƒ‰ì„ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°œì„ í•´ì•¼ í•©ë‹ˆë‹¤.\n"
        "<í”¼ë“œë°± ë‚´ìš©> í˜„ì¬ ì½”ë“œëŠ” ìˆ™ë ¨ë„ë¥¼ ìµœëŒ€ ë‚œì´ë„ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ ê°ì†Œì‹œí‚¤ë©´ì„œ ì œí•œ ì‹œê°„ ë‚´ì— í¼ì¦ì„ í•´ê²°í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤. "
        "ì´ ì ‘ê·¼ ë°©ì‹ì€ ìµœì•…ì˜ ê²½ìš° O(max(diffs) * n)ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°€ì§€ë©°, diffsì˜ ìµœëŒ€ê°’ì´ 100,000ì¸ ìƒí™©ì—ì„œ ë§¤ìš° ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. "
        "ì´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ ì´ë¶„ íƒìƒ‰ì„ ì‚¬ìš©í•˜ì—¬ ìˆ™ë ¨ë„ì˜ ìµœì†Ÿê°’ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤. "
        "ì´ë¶„ íƒìƒ‰ì„ ì ìš©í•˜ë©´, ìˆ™ë ¨ë„ì˜ ë²”ìœ„ë¥¼ ë°˜ì”© ì¤„ì—¬ê°€ë©° ê° ë‹¨ê³„ì—ì„œ ì œí•œ ì‹œê°„ ë‚´ì— í¼ì¦ì„ í•´ê²°í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, "
        "ì´ë¥¼ í†µí•´ ì‹œê°„ ë³µì¡ë„ë¥¼ O(n log(max(diffs)))ë¡œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. "
        "ì´ ë°©ì‹ì€ ìˆ™ë ¨ë„ì˜ ì¤‘ê°„ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í¼ì¦ í•´ê²° ê°€ëŠ¥ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê³ , ê·¸ ê²°ê³¼ì— ë”°ë¼ íƒìƒ‰ ë²”ìœ„ë¥¼ ì¡°ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.\n"
        "```\n\n",

        "**ì¶œë ¥:** (ì ˆëŒ€ `<í”¼ë“œë°± ì œëª©>`ì„ í¬í•¨í•˜ì§€ ë§ ê²ƒ!)\n"
        "```\n"
        "**ğŸ” í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì **\n"
        "- ìˆ™ë ¨ë„ë¥¼ ìµœëŒ€ ë‚œì´ë„ë¶€í„° ê°ì†Œì‹œí‚¤ë©° í¼ì¦ í•´ê²° ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë°©ì‹.\n"
        "- ìµœì•…ì˜ ê²½ìš° **O(max(diffs) * n)** ì˜ ì‹œê°„ ë³µì¡ë„ë¥¼ ê°€ì§.\n"
        "- `diffs`ì˜ ìµœëŒ€ê°’ì´ **100,000**ì¼ ë•Œ ë¹„íš¨ìœ¨ì .\n\n"
        "**ğŸš€ í•´ê²° ë°©ë²•: ì´ë¶„ íƒìƒ‰ ì ìš©**\n"
        "1. **ì´ë¶„ íƒìƒ‰ì„ í†µí•´ ìˆ™ë ¨ë„ì˜ ìµœì†Ÿê°’ì„ ì°¾ìŒ**  \n"
        "   - ìˆ™ë ¨ë„ì˜ ì¤‘ê°„ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ í¼ì¦ í•´ê²° ê°€ëŠ¥ ì—¬ë¶€ë¥¼ íŒë‹¨.  \n"
        "   - ê²°ê³¼ì— ë”°ë¼ íƒìƒ‰ ë²”ìœ„ë¥¼ ì¡°ì •í•˜ì—¬ ìµœì ì˜ ìˆ™ë ¨ë„ë¥¼ ì°¾ìŒ.\n\n"
        "2. **ì‹œê°„ ë³µì¡ë„ ê°œì„ **  \n"
        "   - ê¸°ì¡´ ë°©ì‹: **O(max(diffs) * n)**  \n"
        "   - ì´ë¶„ íƒìƒ‰ ì ìš© í›„: **O(n log(max(diffs)))**  \n"
        "   - íƒìƒ‰ ë²”ìœ„ë¥¼ ë°˜ì”© ì¤„ì—¬ ë” ë¹ ë¥´ê²Œ ê²°ê³¼ ë„ì¶œ ê°€ëŠ¥.\n\n"
        "**âœ… ê¸°ëŒ€ íš¨ê³¼**\n"
        "- ê¸°ì¡´ ë°©ì‹ ëŒ€ë¹„ **ë” ë¹ ë¥¸ ì—°ì‚° ì†ë„**.\n"
        "- `max(diffs)`ê°€ í° ê²½ìš°ì—ë„ **íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘**.\n"
        "```"
    ]

    return read_content

def sucess_lines_prompt() :
    success_prompt = [
        "ë‹¹ì‹ ì˜ ì—­í• ì€ ì£¼ì–´ì§„ ì½”ë“œ(`index_code`)ê°€ <í”¼ë“œë°± ì œëª©>ê³¼ <í”¼ë“œë°± ë‚´ìš©>ì—ì„œ ì œì‹œëœ ìš”êµ¬ ì‚¬í•­ì„ ì„±ê³µì ìœ¼ë¡œ í•´ê²°í•œ ë¶€ë¶„ì´ ì–´ë””ì¸ì§€ ì°¾ì•„ë‚´ëŠ” ê²ƒì…ë‹ˆë‹¤.",
        "ì½”ë“œëŠ” ì´ë¯¸ `generate_index_code(source_code)`ë¥¼ ì‚¬ìš©í•˜ì—¬ `index_code`ë¡œ ë³€í™˜ë˜ì—ˆìœ¼ë©°, ì¤„ ë²ˆí˜¸ì™€ ì½”ë“œê°€ í•¨ê»˜ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
        "ë‹¹ì‹ ì€ `index_code`ë¥¼ ë¶„ì„í•˜ì—¬ í•´ë‹¹ í”¼ë“œë°±ì´ ë°˜ì˜ëœ ì •í™•í•œ ì¤„ ë²ˆí˜¸ ë²”ìœ„ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.",
        "ì¶œë ¥ì€ ë°˜ë“œì‹œ ì§€ì •ëœ í˜•ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ì•¼ í•˜ë©°, í˜•ì‹ì—ì„œ ë²—ì–´ë‚œ ì¶œë ¥ì€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        "í”¼ë“œë°±ì´ ë°˜ì˜ëœ ë¶€ë¶„ì„ ì°¾ì„ ë•Œ, í•´ë‹¹ ë³€ê²½ì´ ì •í™•íˆ ì–´ë–¤ ì½”ë“œì—ì„œ ì´ë£¨ì–´ì¡ŒëŠ”ì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì¤„ ë²ˆí˜¸ë¥¼ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤.",
        "ì¶œë ¥ ì‹œ <í”¼ë“œë°± ì œëª©>ê³¼ <í”¼ë“œë°± ë‚´ìš©>ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë©°, ë‚´ìš©ì„ ìš”ì•½í•˜ê±°ë‚˜ ì¬êµ¬ì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        "ì¶œë ¥ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤",
        """
    <title> í”¼ë“œë°± ì œëª© </title>
    (ì‹œì‘ ì¤„, ë ì¤„) í”¼ë“œë°± ë‚´ìš©
        """,
        "ì¶œë ¥ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤",
        """
    <title> ì´ë¶„ íƒìƒ‰ ìµœì í™” </title>
    (17, 25) ê¸°ì¡´ì—ëŠ” ì´ë¶„ íƒìƒ‰ì˜ ë²”ìœ„ ì„¤ì •ì´ ë¹„íš¨ìœ¨ì ì´ì—ˆìœ¼ë‚˜, ìµœì ì˜ mid ê°’ì„ ì¡°ì •í•˜ëŠ” ë¡œì§ì´ ê°œì„ ë˜ì–´ ë” ì •í™•í•œ ê²°ê³¼ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """,
        "ì¤„ ë²ˆí˜¸(`ì‹œì‘ ì¤„, ë ì¤„`)ëŠ” ë°˜ë“œì‹œ `index_code`ì—ì„œ í”¼ë“œë°±ì´ ë°˜ì˜ëœ ë¶€ë¶„ì˜ ì²« ë²ˆì§¸ ì¤„ê³¼ ë§ˆì§€ë§‰ ì¤„ì„ ì •í™•í•˜ê²Œ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.",
        "ë‹¨ìˆœíˆ `ì½”ë“œê°€ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.`ë¼ê³  í•˜ì§€ ë§ê³ , ì–´ë–¤ ì ì´ ê°œì„ ë˜ì—ˆëŠ”ì§€ë¥¼ ëª…í™•í•˜ê²Œ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤.",
        "ì¶œë ¥ ê²°ê³¼ëŠ” í•œ ì¤„ ê³µë°± ì—†ì´ ì—°ì†ëœ í˜•ì‹ìœ¼ë¡œ ì œê³µë˜ì–´ì•¼ í•©ë‹ˆë‹¤.",
    ]
    
    return success_prompt

    
########################parse,re_Final_function#############################################
# ì£¼ì–´ì§„ ì½”ë“œ ë¬¸ìì—´ì— ì¤„ ë²ˆí˜¸ë¥¼ ì¶”ê°€í•˜ì—¬ index_codeë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜.
def generate_index_code(code):
    lines = code.split('\n')  # ì½”ë“œ ì¤„ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê¸°
    index_code = "\n".join([f"{i+1}: {line}" for i, line in enumerate(lines)])  # ì¤„ ë²ˆí˜¸ ì¶”ê°€
    return index_code

def description_sc(response):
    """
    response ë¬¸ìì—´ì—ì„œ <content>ì™€ <status> ê°’ì„ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
    """
    content_match = re.search(r'<content>(.*?)</content>', response, re.DOTALL)
    status_match = re.search(r'<status>(.*?)</status>', response)

    content = content_match.group(1).strip() if content_match else None
    status = status_match.group(1).strip() if status_match else None

    return content, status

def process_rentest_list(rentest_list):
    fail_list = []
    total_list = []
    pass_list = []

    for title, content, status in rentest_list:
        if status == 'fail':
            fail_list.append([title, content])  # ì‹¤íŒ¨í•œ ê²½ìš° fail_listì— ì¶”ê°€
        else :
            pass_list.append([title,content])

        total_list.append([title, content, 0, 0, status])  # ëª¨ë“  í•­ëª©ì„ total_listì— ì¶”ê°€

    return fail_list, total_list, pass_list

def update_total_list_from_pem_list(pem_list, total_list):
    """
    tem_listì— ìˆëŠ” ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ total_listì— ë°˜ì˜í•˜ëŠ” í•¨ìˆ˜.
    ê°™ì€ titleì´ ìˆìœ¼ë©´ new_contentì™€ (new_start_line, new_end_line)ì„ ì—…ë°ì´íŠ¸í•¨.
    """
    for response in pem_list:
        # ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì—¬ title, (new_start_line, new_end_line), new_content ì¶”ì¶œ
        match = re.search(r'<title>(.*?)</title>\s*\((\d+),\s*(\d+)\)\s*(.*)', response, re.DOTALL | re.MULTILINE)

        if match:
            title = match.group(1).strip()
            new_start_line = int(match.group(2))
            new_end_line = int(match.group(3))
            new_content = match.group(4).strip()

            # total_list ì—…ë°ì´íŠ¸
            for i, item in enumerate(total_list):
                existing_title, existing_content, start_line, end_line, status = item

                if existing_title == title:
                    # ê°™ì€ titleì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
                    total_list[i] = [title, new_content, new_start_line, new_end_line, status]
                    break  # í•œ ë²ˆ ì—…ë°ì´íŠ¸í•˜ë©´ ë£¨í”„ ì¢…ë£Œ

    return total_list

def update_total_list_from_tem_list(tem_list, total_list):
    """
    tem_listì— ìˆëŠ” ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ total_listì— ë°˜ì˜í•˜ëŠ” í•¨ìˆ˜.
    ê°™ì€ titleì´ ìˆìœ¼ë©´ new_contentì™€ (new_start_line, new_end_line)ì„ ì—…ë°ì´íŠ¸í•¨.
    """
    for response in tem_list:
        # ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì—¬ title, (new_start_line, new_end_line), new_content ì¶”ì¶œ
        match = re.search(r'<title>(.*?)</title>\s*\((\d+),\s*(\d+)\)', response, re.DOTALL | re.MULTILINE)

        if match:
            title = match.group(1).strip()
            new_start_line = int(match.group(2))
            new_end_line = int(match.group(3))

            # total_list ì—…ë°ì´íŠ¸
            for i, item in enumerate(total_list):
                existing_title, existing_content, start_line, end_line, status = item

                if existing_title == title:
                    # ê°™ì€ titleì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
                    total_list[i] = [title, existing_content, new_start_line, new_end_line, status]
                    break  # í•œ ë²ˆ ì—…ë°ì´íŠ¸í•˜ë©´ ë£¨í”„ ì¢…ë£Œ

    return total_list

def convert_status_to_boolean(final_list):
    """
    final_listì—ì„œ pass/failì„ True/Falseë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    """
    updated_list = [[title, content, start_line, end_line, status == 'pass'] for title, content, start_line, end_line, status in final_list]
    
    return updated_list


########################chatgpt_function########################################

def chat_with_gpt(prompt, review_content):
    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "system", "content": msg} for msg in review_content] + [
            {"role": "user", "content": prompt}
        ],
        max_tokens=1000,
        temperature=0.7,
    )
    return response.choices[0].message.content


def chat2_with_gpt(prompt, line_content):
    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "system", "content": msg} for msg in line_content] + [
            {"role": "user", "content": prompt}
        ],
        max_tokens=1000,
        temperature=0.7,
    )
    return response.choices[0].message.content

def chat3_with_gpt(prompt, mark_content):
    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "system", "content": msg} for msg in mark_content] + [
            {"role": "user", "content": prompt}
        ],
        max_tokens=1000,
        temperature=0.7,
    )
    return response.choices[0].message.content


########################review, re_review function #########################################
def generate_review(prob,source_code) :
    review_content = review_system_prompt()

    user_input = f"<ë¬¸ì œ ì„¤ëª…> {prob}\n<í’€ì´ ì½”ë“œ> {source_code}"

    content_response = chat_with_gpt(user_input, review_content)

    # ğŸ”¹ ì •ê·œ í‘œí˜„ì‹ì—ì„œ ëŒ€ì†Œë¬¸ìë¥¼ ë¬´ì‹œí•˜ë„ë¡ `(?i)` ì¶”ê°€
    contents = re.findall(r'(?i)<content>(.*?)</content>', content_response, re.DOTALL)
    details = re.findall(r'(?i)<detail>(.*?)</detail>', content_response, re.DOTALL)

    # [[<content>, <detail>], [<content>, <detail>], ...] í˜•íƒœë¡œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
    result = [[content.strip(), detail.strip()] for content, detail in zip(contents, details)]

    maybe_feedback = []
    line_content = lines_system_prompt()
    index_code = generate_index_code(source_code)

    caution = """
âœ… caution :
    - ë°˜ë“œì‹œ í•˜ë‚˜ì˜ (ì‹œì‘ ì¤„, ë ì¤„) ê°œì„  ì‚¬í•­ë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
    - ë§Œì•½ ì—¬ëŸ¬ ê°œì˜ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²½ìš°, ê°€ì¥ í•µì‹¬ì ì¸ í•œ ê°€ì§€ë¥¼ GPTê°€ ì„ íƒí•˜ì—¬ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
    - ì—¬ëŸ¬ ê°œì˜ (ì‹œì‘ ì¤„, ë ì¤„) ê°œì„  ì‚¬í•­ì„ ë‚˜ì—´í•˜ì§€ ë§ê³ , ì˜¤ì§ í•˜ë‚˜ë§Œ ì¶œë ¥í•˜ì„¸ìš”.
"""
        
    for title, content in result:
        user_input3 = f"<feedback_title>{title}</feedback_title>\n<feedback_content> {content}</feedback_content>\n<problem> {prob}</problem>\n<usercode> {index_code}</usercode>\n <caution> {caution}"
        response = chat2_with_gpt(user_input3, line_content)
        maybe_feedback.append(response)

    # ìµœì¢… ê²°ê³¼ë¥¼ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸
    final_list = []
    temp_list = []

    # ê° í”¼ë“œë°±ì„ ìˆœíšŒí•˜ë©° (ì‹œì‘ ì¤„, ë ì¤„) ì¶”ì¶œ
    for (title, content), feedback in zip(result, maybe_feedback):
        match = re.search(r"\((\d+),\s*(\d+)\)", feedback)  # (ì‹œì‘ ì¤„, ë ì¤„)ë§Œ ì¶”ì¶œ
        if match:
            start_line, end_line = match.groups()
            temp_list.append([title,content])  
            final_list.append([title, content, int(start_line), int(end_line), False]) 

    return final_list if final_list else []


#################################################################################
# "reviews"ì—ì„œ [title,content]ë¡œ ì´ë£¨ì–´ì§„ ë¦¬ìŠ¤íŠ¸ previous_feedback
def generate_re_review(prob,source_code,reviews) :
    previous_list = [(review["title"], review["comments"]) for review in reviews]
    # previous_feedback = f'"""\n{json.dumps(previous_list, indent=4, ensure_ascii=False)}\n"""'
    rentest_list = list()

    re_review_content = re_review_system_prompt()
    for title, content in previous_list : 
        user_input2 = f"<ë¬¸ì œ ì„¤ëª…> {prob}\n<í’€ì´ ì½”ë“œ> {source_code}\n<í”¼ë“œë°± ì œëª©>{title}\n<í”¼ë“œë°± ë‚´ìš©>{content}"
        response = chat_with_gpt(user_input2,re_review_content)
        new_content, new_status = description_sc(response)
        rentest_list.append([title,new_content,new_status])

    fail_list, total_list,pass_list = process_rentest_list(rentest_list)

    tem_list = list()
    line_content = lines_system_prompt()
    index_code = generate_index_code(source_code)
    caution = """
    âœ… ì£¼ì˜ ì‚¬í•­:
        - ë°˜ë“œì‹œ í•˜ë‚˜ì˜ (ì‹œì‘ ì¤„, ë ì¤„) ê°œì„  ì‚¬í•­ë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
        - ë§Œì•½ ì—¬ëŸ¬ ê°œì˜ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²½ìš°, ê°€ì¥ í•µì‹¬ì ì¸ í•œ ê°€ì§€ë¥¼ GPTê°€ ì„ íƒí•˜ì—¬ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
        - ì—¬ëŸ¬ ê°œì˜ (ì‹œì‘ ì¤„, ë ì¤„) ê°œì„  ì‚¬í•­ì„ ë‚˜ì—´í•˜ì§€ ë§ê³ , ì˜¤ì§ í•˜ë‚˜ë§Œ ì¶œë ¥í•˜ì„¸ìš”.
    """
    for i in range(len(fail_list)) :
        user_input4 = "<feedback_title>"+fail_list[i][0] + "</feedback_title>" + "\n"+ "<feedback_content>" + fail_list[i][1] + "</feedback_content>"+ "\n" + "<problem>" + prob + "</problem>" +"\n" + "<usercode>" + index_code +"</usercode>" +"\n" + "<ì£¼ì˜ì‚¬í•­>"+ caution
        response = chat2_with_gpt(user_input4, line_content)
        tem_list.append(response)

    ## ì„±ê³µí•œ í”¼ë“œë°±
    pem_list = list()
    sucess_prompt = sucess_lines_prompt()
    for i in range(len(pass_list)) : 
        user_input5 = "<í”¼ë“œë°± ì œëª©>"+ pass_list[i][0] + "\n"+ "<í”¼ë“œë°± ë‚´ìš©>" + pass_list[i][1] + "\n" + "<ë¬¸ì œì„¤ëª…>" + prob + "\n" + "<í’€ì´ì½”ë“œ>" + index_code + "\n" + caution
        response = chat2_with_gpt(user_input5, sucess_prompt)
        pem_list.append(response)
    
    medium_list = update_total_list_from_tem_list(tem_list, total_list)
    final_list = update_total_list_from_pem_list(pem_list, medium_list)

    updated_final_list = convert_status_to_boolean(final_list)
    final_list.clear()
    final_list = updated_final_list

    temp_list = [[title, content] for title, content, _, _, _ in final_list]

    markdown_prompt = markdown_system_prompt()
    contest_list = list()
    for title,content in temp_list :
        user_mark = f"<í”¼ë“œë°± ì œëª©>{title} \n<í”¼ë“œë°± ë‚´ìš©>{content}"
        response = chat2_with_gpt(user_mark,markdown_prompt)
        contest_list.append([title,response])
    temp_list.clear()

        # ì •ì œëœ contest_listë¥¼ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸
    cleaned_contest_list = []

    # contentë¥¼ ë§ˆí¬ë‹¤ìš´ì´ ì ìš©ëœ í˜•íƒœë¡œ ì •ì œ
    for title, content in contest_list:
        cleaned_content = content.replace("```", "").strip()  # ë¶ˆí•„ìš”í•œ ``` ì œê±°
        cleaned_content = re.sub(r"</?content>", "", cleaned_content).strip()  # <content> íƒœê·¸ ì œê±°
        cleaned_contest_list.append([title, cleaned_content])  # ìƒˆë¡œìš´ ë¦¬ìŠ¤íŠ¸ì— ì €ì¥

    contest_list.clear()
    contest_list = cleaned_contest_list

    # content_listë¥¼ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜ (title -> good_content)
    content_dict = {title: good_content for title, good_content in contest_list}

    # final_list ì—…ë°ì´íŠ¸
    for item in final_list:
        title = item[0]  # í˜„ì¬ title
        if title in content_dict:  # ì •ì œëœ contentê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°
            item[1] = content_dict[title]  # content ì—…ë°ì´íŠ¸

    return final_list if final_list else []

# final_list = generate_ai_review(prob, source_code,problem_info)

#################################################################################
#########################Main Function###########################################
def generate_ai_review(prob : str, source_code : str, reviews : list) : 
    if len(reviews) > 0 :
        result = generate_re_review(prob,source_code,reviews)
    else :
        result = generate_review(prob,source_code)

    if result is None:
        result = []     

    return result

def generate_chatbot(request_data: dict) -> str:
    messages = chatbot_system_prompt()

    for q, r in zip(request_data["questions"], request_data["answers"]):
        messages.append({"role": "user", "content": q})
        messages.append({"role": "assistant", "content": r})

    messages.append({
        "role": "user",
        "content": (
            f"< ë¬¸ì œ ì„¤ëª… >\n{request_data['problem_info']}\n\n"
            f"< í’€ì´ ì½”ë“œ >\n{request_data['source_code']}\n\n"
            f"< í”¼ë“œë°± ì£¼ì œ >\n{request_data['review_info']['title']}\n\n"
            f"< í”¼ë“œë°± ë‚´ìš© >\n{request_data['review_info']['comments']}\n\n"
            f"< ì§ˆë¬¸ >\n{request_data['questions'][-1]}\n\n"
            "ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ìƒì„¸í•œ ë‹µë³€ì„ ìƒì„±í•˜ì„¸ìš”."
        )
    })

    try:
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=messages,
            max_tokens=600
        )

        # âœ… ìˆ˜ì •ëœ ë¶€ë¶„: ["content"] ëŒ€ì‹  .content ì†ì„± ì‚¬ìš©
        chatbot_response = response.choices[0].message.content  

        if not chatbot_response:
            print("âš ï¸ OpenAI ì‘ë‹µì´ ë¹„ì–´ ìˆìŒ!")
            return "ì£„ì†¡í•©ë‹ˆë‹¤. í˜„ì¬ ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

        return chatbot_response
    except openai.OpenAIError as e:
        print(f"OpenAI API Error: {str(e)}")
        return f"OpenAI API Error: {str(e)}"
    except Exception as e:
        print(f"Internal Server Error: {str(e)}")
        return f"Internal Server Error: {str(e)}"

### ëª¨ë²”ë‹µì•ˆ
def solution_system_prompt () :
    final_content = [
        "ë‹¹ì‹ ì€ ì½”ë“œ ìµœì í™”ë¥¼ ì „ë¬¸ìœ¼ë¡œ í•˜ëŠ” AI ì—”ì§€ë‹ˆì–´ì…ë‹ˆë‹¤.",
        "ì‚¬ìš©ìê°€ ì œê³µí•œ ì½”ë“œ(<code>)ëŠ” <prob>ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",
        "ì‚¬ìš©ìëŠ” FINAL_LISTì˜ í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ìµœì í™”ëœ ìµœì¢… ì½”ë“œ(Final Code)ë¥¼ ì›í•©ë‹ˆë‹¤.",
        
        "## ì…ë ¥ ë°ì´í„° ì„¤ëª…",
        "1. <ë¬¸ì œ ì„¤ëª…>: ë¬¸ì œì˜ ì„¤ëª…ì´ í¬í•¨ë©ë‹ˆë‹¤.",
        "2. <í’€ì´ ì½”ë“œ>: ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê¸°ì¡´ ì½”ë“œì…ë‹ˆë‹¤.",
        "3. <FINAL_LIST>: ì½”ë“œì—ì„œ ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ê³¼ ìˆ˜ì • ë°©í–¥ì„ ì œê³µí•©ë‹ˆë‹¤.",
        """   - í˜•ì‹: `[í”¼ë“œë°± ì œëª©, í”¼ë“œë°± ë‚´ìš©, ì‹œì‘ ì¤„ ë²ˆí˜¸, ë ì¤„ ë²ˆí˜¸]`",
            - 'ì‹œì‘ ì¤„ ë²ˆí˜¸'ì™€ 'ë ì¤„ ë²ˆí˜¸'ëŠ” **ê¸°ì¡´ ì½”ë“œì—ì„œ ìˆ˜ì •ì´ í•„ìš”í•œ ì˜ì—­ì„ ì§€ì •**í•©ë‹ˆë‹¤.""",
        
        "## ì½”ë“œ ìˆ˜ì • ì§€ì¹¨",
        "1. **FINAL_LISTì˜ í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ í•„ìš”í•œ ë¶€ë¶„ë§Œ ë³€ê²½**",
        """   - í”¼ë“œë°±ì— ì§€ì •ëœ ì¤„ ë²ˆí˜¸(ì‹œì‘ ì¤„ ~ ë ì¤„)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.",
            - **ë‹¨, ìµœì í™”ëœ ì½”ë“œì—ì„œ ìˆ˜ì •ëœ ì¤„ ë²ˆí˜¸ëŠ” ê¸°ì¡´ ì½”ë“œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**",
            - ìµœì í™” ê³¼ì •ì—ì„œ **ì¤„ ìˆ˜ê°€ ë³€ê²½ë  ê²½ìš° ìƒˆë¡œìš´ ì¤„ ë²ˆí˜¸ë¥¼ ìë™ìœ¼ë¡œ ë°˜ì˜**í•´ì•¼ í•©ë‹ˆë‹¤.""",
        
        "2. **ì½”ë“œ ì„±ëŠ¥ê³¼ ê°€ë…ì„± ê°œì„ **",
        """   - ë¶ˆí•„ìš”í•œ ë³€ìˆ˜ ë° ì¤‘ë³µ ë¡œì§ì„ ì œê±°í•˜ê³ , ìµœì ì˜ ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•©ë‹ˆë‹¤.",
            - ì½”ë“œì˜ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ê¸° ìœ„í•´ ê°€ë…ì„±ì„ ê³ ë ¤í•©ë‹ˆë‹¤.""",
        
        "3. **ë¶ˆí•„ìš”í•œ ë³€ê²½ì€ í•˜ì§€ ì•ŠìŒ**",
        """   - í”¼ë“œë°±ì´ ì—†ëŠ” ì½”ë“œ ë¶€ë¶„ì€ ë³€ê²½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
            - ì½”ë“œ ìŠ¤íƒ€ì¼ì„ ë¶ˆí•„ìš”í•˜ê²Œ ë³€ê²½í•˜ì§€ ì•Šê³ , ì›ë˜ì˜ íë¦„ì„ ìœ ì§€í•©ë‹ˆë‹¤.""",
        
        "## ì¶œë ¥ í˜•ì‹",
        "ìµœì í™”ëœ ìµœì¢… ì½”ë“œë§Œ ì¶œë ¥í•´ì•¼ í•©ë‹ˆë‹¤.",
        "ì¶œë ¥ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:",
        """
        <code>
        ìµœì í™”ëœ ì½”ë“œ
        </code>
        <lines>
            <line>
                <title>í”¼ë“œë°± ì œëª©</title>
                <start_line>ìµœì í™”ëœ ì½”ë“œì—ì„œì˜ ì‹œì‘ ì¤„ ë²ˆí˜¸</start_line>
                <end_line>ìµœì í™”ëœ ì½”ë“œì—ì„œì˜ ë ì¤„ ë²ˆí˜¸</end_line>
            </line>
            <line>
                <title>í”¼ë“œë°± ì œëª©</title>
                <start_line>ìµœì í™”ëœ ì½”ë“œì—ì„œì˜ ì‹œì‘ ì¤„ ë²ˆí˜¸</start_line>
                <end_line>ìµœì í™”ëœ ì½”ë“œì—ì„œì˜ ë ì¤„ ë²ˆí˜¸</end_line>
            </line>
            ...
        </lines>
        """
    ]

    return final_content

def chat3_with_gpt(prompt,solution_prompt):
    response = response = client.chat.completions.create(
    model="gpt-4o",
    messages=[
   *[{"role": "system", "content": msg} for msg in solution_prompt],
        {
        "role": "user",
        "content": prompt
        }
    ],
        max_tokens=1000,
        temperature=0.7,
    )

    return response.choices[0].message.content


# í…ŒìŠ¤íŠ¸ ì‹¤í–‰

def generate_solution_code(problem_info : str , source_code : str, reviews : list) :

    final_list = [(review["title"], review["comments"],review["start_line_number"],review["end_line_number"]) for review in reviews]
    final_feedback = f'"""{json.dumps(final_list)}"""'

    prob = problem_info
    index_code = generate_index_code(source_code)

    solution_prompt = solution_system_prompt ()
    user_input3 = "<ë¬¸ì œ ì„¤ëª…>" + prob + "\n" + "<í’€ì´ ì½”ë“œ>" + index_code + "\n" + "<FINAL_LIST>" + final_feedback
    code_response = chat3_with_gpt(user_input3,solution_prompt)

    # ğŸ”¹ í”„ë¡œê·¸ë˜ë° ì½”ë“œ ì¶”ì¶œ (XML ì‹œì‘ ì „ê¹Œì§€ í…ìŠ¤íŠ¸ë¥¼ ì½”ë“œë¡œ ê°„ì£¼)
    code_match = re.search(r"^(.*?)(?=\n<lines>)", code_response, re.DOTALL)
    markdown_code = code_match.group(1).strip() if code_match else "No Code Found"
    middle_lines = markdown_code.splitlines()
    solution_lines = middle_lines[1:-1]
    solution_code = "\n".join(solution_lines)

    # ğŸ”¹ XML ë°ì´í„° ì¶”ì¶œ
    xml_match = re.search(r"<lines>(.*?)</lines>", code_response, re.DOTALL)
    solution_xml = f"<lines>{xml_match.group(1)}</lines>" if xml_match else "No Lines Found"

    # ğŸ”¹ XMLì„ íŒŒì‹±í•˜ì—¬ solution_list ìƒì„±
    solution_list = []
    if "No Lines Found" not in solution_xml:  # XML ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë§Œ ì²˜ë¦¬
        root = ET.fromstring(solution_xml)
        for line in root.findall(".//line"):
            title = line.find("title").text
            start_line = int(line.find("start_line").text) - 1
            end_line = int(line.find("end_line").text) - 1
            solution_list.append([title, start_line, end_line])

    return solution_code, solution_list
